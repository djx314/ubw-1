# 关于如何构建基于列声明的无 Model 系统的一些想法
&emsp;&emsp;鉴于 linux deepin 的中文输入法限制,本文暂时采用英文标点.另:如果想提交 issue,请用英文.

&emsp;&emsp;最近两年写增删查改写得郁闷,然后开始思考如何把代码缩到最短,最初的灵感来源于 @jilen 对我写的
slick 动态 insert 的一个思路整理 https://github.com/scalax/hf/pull/5 ,虽然现在无论是 api
还是内部实现(内部现在用 ListAnyShape 实现,简单高效)都已经面目全非了,但核心的东西一直没变,此后一年的业余时间都在这方面工作.
现在把到目前的成果分享一下.

&emsp;&emsp;问题的开端,源于 MVC 模式的一些思考,首先我们来看看 MVC 模式所需要的东西是哪些?

&emsp;&emsp;首先我们需要建立一个数据库(以 H2 为例)的表,用来存储我们的数据,
```sql
create table "firend" (
    "id" BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "name" VARCHAR NOT NULL,
    "nick" VARCHAR NOT NULL
)
```
注意: id 列是自增的,我们在插入的时候不需要插入这一列的数据.
如果我们是用 Java Hibernate 的话,就需要用 JPA 进行建模了,代码可能是下面这样的:
```java
@Entity
public class Friend implements Serializable {
    private static final long serialVersionUID = 1L;
    
    @Id @GeneratedValue
    private long id;
    
    private String name;
    private String nick;
    
    public Friend() {
    }
    
    Friend(String name, String nick) {
        this.name = name;
        this.nick = nick;
    }
    
    public Long getId() {
        return id;
    }
    
    public String getName() {
        return nick;
    }
    
    public String getNick() {
        return nick;
    }
    
    @Override
    public String toString() {
        return String.format("Friend(%d, %d)", this.getName(), this.getNick());
    }
}
```
然后就需要写一个 Dao 类了,在 Spring 中这个也不难,可以有一个 Abstract Dao,普通的 Dao
如果没有什么需要修改的话直接继承即可.再写一个 Controller,写好增删查改的逻辑,再把你需要和浏览器交互的数据是 Json
格式这一点显式或者隐式地标记一下, Java 这边的工作就做完了.
在浏览器端的话你可能选用 Dojo 这个老牌的框架,然而无论选择哪种框架,做这种千篇一律的 CRUD 的工作应该都差不多,在建好
Table 对象之后,除了匹配 Url 的格式,你还需要匹配每一列的数据类型,于是下面那一段代码你是不能够省略的:
```javascript
var layout = [[
    { "name": "Id", "field": "id" },
    { "name": "姓名", "field": "name" },
    { "name": "昵称", "field": "nick" }
]];
```
花了一大番功夫,你终于做完了一个增删查改,然而还有 100 个增删查改,而且这些增删查改除了字段不同,逻辑有一些会有特殊要求之外,
好像没什么需要特殊处理的地方了,本文就是探求一种方法,如何简化这种千篇一律的操作.
在此先提醒一下,对于一些有相当复杂度的操作,可能本文所提到的模型并不适合,
这个模型目前的进度只适合于那些千篇一律而且会有部分特殊需求的数据转换,
但本文的讨论对象不单单只是数据库操作,还包括 Json 转换和 Excel 操作(POI).